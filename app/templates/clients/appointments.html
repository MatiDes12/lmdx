<<<<<<< HEAD
{% extends 'clients/base.html' %}
{% block navbar %}
{% include 'clients/navbar.html' %}
{% endblock %}
{% block content %}
<section class="container px-4 mx-auto">
<!-- Doctors Table -->
    <div class="flex flex-col mt-6">
        <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
            <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
                <div class="overflow-hidden border border-gray-200 dark:border-gray-700 md:rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th scope="col" class="py-3.5 px-4 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                    <div class="flex items-center gap-x-3">
                                        <input type="checkbox" class="text-blue-500 border-gray-300 rounded dark:bg-gray-900 dark:ring-offset-gray-900 dark:border-gray-700">
                                        <span>Name</span>
                                    </div>
                                </th>
                                <th scope="col" class="px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                    Specialization
                                </th>
                                <th scope="col" class="px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400 whitespace-nowrap pl-24">
                                    Available
                                </th>
                                <th scope="col" class="px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                    Schedule
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 dark:divide-gray-700 dark:bg-gray-900">
                            {% for doctor in doctors %}
                            <tr>
                                <td class="px-4 py-4 text-sm font-medium text-gray-700 whitespace-nowrap">
                                    <div class="inline-flex items-center gap-x-3">
                                        <input type="checkbox" class="text-blue-500 border-gray-300 rounded dark:bg-gray-900 dark:ring-offset-gray-900 dark:border-gray-700">
                                        <div class="flex items-center gap-x-2">
                                            <img class="object-cover w-10 h-10 rounded-full" src="https://i.pravatar.cc/300?img={{ doctor.id }}" alt="{{ doctor.name }}'s profile picture">
                                            <div>
                                                <h2 class="font-dashboard text-gray-800 dark:text-white ">{{ doctor.name }}</h2>
                                            </div>
                                        </div>
                                    </div>
                                </td>

                                <td class="px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap">
                                    {{ doctor.specialization }}
                                </td>
            
                                <td class="px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap">
                                    <div>
                                        {{ doctor.time }}
                                    </div>
                                </td>

                                <td class="px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap">
                                    {% set active_appointment = doctor.get_active_appointment() %}
                                    {% if active_appointment %}
                                    <button class="text-gray-500 bg-gray-200 rounded-full cursor-not-allowed" disabled>
                                        Scheduled
                                    </button>
                                    <form action="{{ url_for('client.cancel_appointment', appointment_id=active_appointment.id) }}" method="POST" style="display:inline;">
                                        <button type="submit" class="ml-2 text-red-700 bg-red-100 rounded-full hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition duration-300">
                                            Cancel
                                        </button>
                                    </form>
                                    {% else %}
                                    <button onclick="openModal({{ doctor.id }})" class="text-indigo-700 bg-indigo-100 rounded-full hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-300">
                                        Schedule
                                    </button>
                                    {% endif %}
                                </td>                                
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- Appointment Modal -->
    <div id="appointmentModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
            <form action="{{ url_for('client.make_appointment') }}" method="POST">
                <input type="hidden" name="doctor_id" id="doctorIdInput">
                <div class="mb-4">
                    <label class="block text-gray-700">Date:</label>
                    <input type="date" name="date" required class="w-full mt-1 px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring focus:ring-blue-200">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Time:</label>
                    <input type="time" name="time" required class="w-full mt-1 px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring focus:ring-blue-200">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Notes:</label>
                    <textarea name="notes" class="w-full mt-1 px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring focus:ring-blue-200"></textarea>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 focus:outline-none focus:ring focus:ring-gray-200">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring focus:ring-indigo-200">Submit</button>
                </div>
            </form>
        </div>
    </div>
</section>

<script>
function openModal(doctorId) {
    document.getElementById('doctorIdInput').value = doctorId;
    document.getElementById('appointmentModal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('appointmentModal').classList.add('hidden');
}
=======
{% extends 'clients/base.html' %} {% block navbar %} {% include
'clients/navbar.html' %} {% endblock %} {% block content %}
<div class="px-6 py-4 bg-gray-100">
  <!-- Header Section -->
  <div
    class="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 p-6 rounded-lg shadow-md mb-8"
  >
    <h1 class="text-3xl font-bold text-white">Your Appointments</h1>
    <p class="text-white text-sm mt-2">
      Manage your healthcare schedule with ease.
    </p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Upcoming Appointments Section -->
    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        Upcoming Appointments 
        <span class="text-sm font-normal text-gray-600 bg-blue-100 inline-block px-2 py-1 rounded-full ml-2 text-blue-800">
          You have {{ upcoming_appointments|length }} Total Appointments
      </h2>
      <div class="space-y-4 overflow-y-auto" style="max-height: 550px;" id="upcoming-appointments">
        {% include 'clients/_upcoming_appointments.html' %}
      </div>
    </div>
    

    <!-- Schedule New Appointment Section -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        Schedule Appointment
      </h2>
      <form action="{{ url_for('patient.appointments') }}" method="POST" class="space-y-4">
        <div>
          <label for="doctor-select" class="block text-sm font-medium text-gray-700 mb-1">Select Doctor</label>
          <select id="doctor-select" name="doctor_id" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
            <option value="" disabled selected>Select your doctor</option>
            {% for doctor in doctors %}
            <option value="{{ doctor.doctor_id }}">
              Dr. {{ doctor.first_name }} {{ doctor.last_name }} - {{ doctor.specialization }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label
            for="date-select"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Select Date</label
          >
          <input
          type="date"
          id="date-select"
          name="appointment_date"
          min="{{ today_date }}"
          class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-gray-500"
        />        
        </div>
        <div>
          <label
            for="time-select"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Select Time</label
          >
          <select
            id="time-select"
            name="appointment_time"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
          >
            {% for time in available_times %}
            <option value="{{ time }}">{{ time }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label
            for="reason"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Reason for Appointment</label
          >
          <input
            type="text"
            id="reason"
            name="reason"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Brief description of your visit"
          />
        </div>
        <div>
          <label
            for="notes"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Additional Notes (Optional)</label
          >
          <textarea
            id="notes"
            name="notes"
            rows="3"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Any additional information for the doctor"
          ></textarea>
        </div>
        <button
          type="submit"
          class="w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-medium py-2 px-4 rounded-md transition duration-300 text-sm"
        >
          Book Appointment
        </button>
      </form>
    </div>

    <!-- Modal for Viewing Appointment Details -->
    <div id="detailsModal" class="hidden fixed z-10 inset-0 overflow-y-auto">
      <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
          <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>
        <!-- Modal content -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modalTitle">Appointment Details</h3>
                <div class="mt-2">
                  <p class="text-sm text-gray-500" id="appointmentDetails">Details will be loaded here...</p>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm" onclick="closeModal()">Close</button>
          </div>
        </div>
      </div>
    </div>




  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const doctorSelect = document.getElementById('doctor-select');
    const dateSelect = document.getElementById('date-select');
    const timeSelect = document.getElementById('time-select');
    const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format

    function updateAvailableTimes() {
      const doctorId = doctorSelect.value;
      const date = dateSelect.value;
      const now = new Date();

      fetch(`{{ url_for('patient.get_available_times', _external=true) }}?doctor_id=${doctorId}&date=${date}`)
        .then(response => response.json())
        .then(times => {
          timeSelect.innerHTML = '';
          if (times.length > 0) {
            times.forEach(time => {
              const timeValue = new Date(date + ' ' + time);
              if (date !== today || timeValue > now) { // Check if the time is in the future for today
                const option = document.createElement('option');
                option.value = time;
                option.textContent = time;
                timeSelect.appendChild(option);
              }
            });
          }
          if (timeSelect.options.length === 0) {
            const option = document.createElement('option');
            option.textContent = 'No available times';
            timeSelect.appendChild(option);
          }
        });
    }

    doctorSelect.addEventListener('change', updateAvailableTimes);
    dateSelect.addEventListener('change', updateAvailableTimes);
    updateAvailableTimes(); // Call on initial load
  });

// function viewDetails(appointmentId, doctorName, appointmentDate, appointmentTime, reason, notes) {
//   // Display the formatted details
//   const details = `
//     <strong>ID:</strong> ${appointmentId}<br>
//     <strong>Doctor:</strong> ${doctorName}<br>
//     <strong>Date:</strong> ${appointmentDate}<br>
//     <strong>Time:</strong> ${appointmentTime}<br>
//     <strong>Reason:</strong> ${reason}<br>
//     <strong>Notes:</strong> ${notes}
//   `;
//   document.getElementById('appointmentDetails').innerHTML = details;
//   document.getElementById('detailsModal').classList.remove('hidden');
// }


>>>>>>> R_Branch
</script>
{% endblock %}
